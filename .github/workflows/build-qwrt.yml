name: Build QWRT

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Clone luci-theme-argon
        run: git clone --depth 1 https://github.com/jerrykuku/luci-theme-argon /tmp/luci-theme-argon

      - name: Copy theme into overlay
        run: |  
          mkdir -p overlay/www/luci-static/argon
          cp -a /tmp/luci-theme-argon/* overlay/www/luci-static/argon/
          mkdir -p overlay/etc/uci-defaults
          cat > overlay/etc/uci-defaults/100-set-theme <<'EOF'
          #!/bin/sh
          uci set luci.main.mediaurlbase=/luci-static/argon
          uci commit luci
          exit 0
          EOF
          chmod +x overlay/etc/uci-defaults/100-set-theme

      - name: Build image
        run: ./build-script.sh